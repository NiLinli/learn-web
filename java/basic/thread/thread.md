# Thread 线程

并发

Java 多线程
PHP  单线程
Js 	 单线程 异步

使用情况: 创建多线程的开销小于并行执行

Java 给多线程编程提供了内置的支持

一条线程指的是进程中一个单一顺序的控制流，
一个进程中可以并发多个线程，
每条线程并行执行不同的任务。

多线程是多任务的一种特别的形式，但多线程使用了更小的资源开销。

这里定义和线程相关的另一个术语 - 进程：一个进程包括由操作系统分配的内存空间，包含一个或多个线程。一个线程不能独立的存在，它必须是进程的一部分。一个进程一直运行，直到所有的非守护线程都结束运行后才能结束。

多线程能满足程序员编写高效率的程序来达到充分利用 CPU 的目的。

- Thread 对象代表线程, 当你需要启动新的线程时就建立新的 Thread 的实例  
- 线程是独立的线程，它代表独立的执行空间
- 每个Java应用程序会启动一个主线程, 将main()放在它执行空间的最开始处

Java多线程之间的关系:

- Java虚拟机调用main()
- main()启动新的线程，新的线程启动期间main的多线程会暂时停止执行
- Java虚拟机会在线程与原来的主线程之间 **来回切换** 直到两者都完成为止  

## Thread

程序设计思想

- Thread 是一个工人
- Runnable 任务(工作)
- 每个 Thread(工人) 需要一个可以放在执行空间任务 (Runnable) 来执行

具体代码, 启动新的线程

1. 建立 Runnable 对象（线程的任务)
2. 建立 Thread 对象并赋值 Runnable -- 新建状态
3. 启动 Thread start() -- 就绪状态
4. run() 运行状态
5. sleep()  suspend() ...阻塞状态
6. 死亡状态

### 线程的优先级

- 每一个 Java 线程都有一个优先级, 这样有助于操作系统确定线程的调度顺序
- Java 线程的优先级是一个整数 1 Thread.MIN_PRIORITY-- 10 Thread.MAX_PRIORITY
- 默认情况下, 每一个线程都会分配一个优先级 NORM_PRIORITY 5
- 具有较高优先级的线程对程序更重要, 并且应该在低优先级的线程之前分配处理器资源
- **线程优先级不能保证线程执行的顺序，而且非常依赖于平台**

### 多线程编程

- 线程同步 synchronized
- 线程间通信
- 线程死锁
- 线程控制：挂起、停止和恢复

#### 线程同步

代表线程需要一把钥匙来存取被同步化过的线程，要保护数据，就把作用在数据上的方法同步化
使用 synchronized 这个关键词来修饰的方法使它每次只能被单一的线程存储

- 每个Java对象都有一个锁, 每个锁都有一把钥匙, 通常对象没有上锁  
- 如果对象有同步化的方法, 线程只能在去的钥匙的情况下进入线程, 也就是说没有其他线程已经进入的情况下才能进入  
- 锁是配在对象上, 不是配在方法上
- 一个对象有两个同步方法, 则两个线程无法同时访问同一对象两个不同的方法
- 锁住的不是数据而是存储数据的方法

## 优点

## 缺点

- 状态同步
- 死锁
- 线程上下文交换带来的性能开销

## 进程和线程

程序 A, B 同时执行

A 中由 a1, a2, a3
B 中有 b1, b2, b3

进程交换: A 与 B 交替执行
线程交换: a1 与 b1 交替执行

- 进程和线程都是一个时间段的描述，是CPU工作时间段的描述, 不过是颗粒大小不同
- 进程就是包换上下文切换的程序执行时间总和 = CPU加载上下文 + CPU执行 + CPU 保存上下文
- 线程是共享了进程的上下文环境, 运行在单一进程上


  